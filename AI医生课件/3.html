
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="img/logo.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>第三章:neo4j图数据库 - AI医生 V3.0</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#31-neo4j" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="." title="AI医生 V3.0" class="md-header__button md-logo" aria-label="AI医生 V3.0" data-md-component="logo">
      
  <img src="img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AI医生 V3.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第三章:neo4j图数据库
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    <img src="assets/images/logo.svg" height="45px" alt="logo">

  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="AI医生 V3.0" class="md-nav__button md-logo" aria-label="AI医生 V3.0" data-md-component="logo">
      
  <img src="img/logo.png" alt="logo">

    </a>
    AI医生 V3.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="1.html" class="md-nav__link">
        第一章:背景介绍及AI医生架构
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="2.html" class="md-nav__link">
        第二章:项目工具介绍
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          第三章:neo4j图数据库
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="3.html" class="md-nav__link md-nav__link--active">
        第三章:neo4j图数据库
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#31-neo4j" class="md-nav__link">
    3.1 neo4j介绍
  </a>
  
    <nav class="md-nav" aria-label="3.1 neo4j介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-neo4j" class="md-nav__link">
    1 neo4j简介
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-neo4j" class="md-nav__link">
    2 neo4j图数据库概念
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#32-neo4j" class="md-nav__link">
    3.2 neo4j图数据库的安装
  </a>
  
    <nav class="md-nav" aria-label="3.2 neo4j图数据库的安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-neo4j_1" class="md-nav__link">
    1 neo4j图数据库的安装流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-neo4j_1" class="md-nav__link">
    2 neo4j的可视化管理后台登陆
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#33-cypher" class="md-nav__link">
    3.3 Cypher介绍与使用
  </a>
  
    <nav class="md-nav" aria-label="3.3 Cypher介绍与使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create" class="md-nav__link">
    1 create命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-match" class="md-nav__link">
    2 match命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-merge" class="md-nav__link">
    3 merge命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-create" class="md-nav__link">
    4 使用create创建关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-merge" class="md-nav__link">
    5 使用merge创建关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-where" class="md-nav__link">
    6 where命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-delete" class="md-nav__link">
    7 delete命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-sort" class="md-nav__link">
    8 sort命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    9 字符串函数：
  </a>
  
    <nav class="md-nav" aria-label="9 字符串函数：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-toupper" class="md-nav__link">
    1 toUpper()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-tolower" class="md-nav__link">
    2 toLower()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-substring" class="md-nav__link">
    3 substring()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-replace" class="md-nav__link">
    4 replace()函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    10 聚合函数
  </a>
  
    <nav class="md-nav" aria-label="10 聚合函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-count" class="md-nav__link">
    1 count()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-max" class="md-nav__link">
    2 max()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-min" class="md-nav__link">
    3 min()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-sum" class="md-nav__link">
    4 sum()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-avg" class="md-nav__link">
    5 avg()函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-index" class="md-nav__link">
    11 索引index
  </a>
  
    <nav class="md-nav" aria-label="11 索引index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1 创建索引
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 删除索引
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    12 小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#34-pythonneo4j" class="md-nav__link">
    3.4 在Python中使用neo4j
  </a>
  
    <nav class="md-nav" aria-label="3.4 在Python中使用neo4j">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-neo4j-driver" class="md-nav__link">
    1 neo4j-driver简介：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2 事务的概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    3 小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="4.html" class="md-nav__link">
        第四章:离线部分
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="5.html" class="md-nav__link">
        第五章:命名实体审核任务
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="6.html" class="md-nav__link">
        第六章:命名实体识别任务
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="7.html" class="md-nav__link">
        第七章:在线部分
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="8.html" class="md-nav__link">
        第八章:句子主题相关任务
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="9.html" class="md-nav__link">
        第九章:系统联调与测试
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10.html" class="md-nav__link">
        附录:环境安装部署手册
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#31-neo4j" class="md-nav__link">
    3.1 neo4j介绍
  </a>
  
    <nav class="md-nav" aria-label="3.1 neo4j介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-neo4j" class="md-nav__link">
    1 neo4j简介
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-neo4j" class="md-nav__link">
    2 neo4j图数据库概念
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#32-neo4j" class="md-nav__link">
    3.2 neo4j图数据库的安装
  </a>
  
    <nav class="md-nav" aria-label="3.2 neo4j图数据库的安装">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-neo4j_1" class="md-nav__link">
    1 neo4j图数据库的安装流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-neo4j_1" class="md-nav__link">
    2 neo4j的可视化管理后台登陆
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3 小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#33-cypher" class="md-nav__link">
    3.3 Cypher介绍与使用
  </a>
  
    <nav class="md-nav" aria-label="3.3 Cypher介绍与使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create" class="md-nav__link">
    1 create命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-match" class="md-nav__link">
    2 match命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-merge" class="md-nav__link">
    3 merge命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-create" class="md-nav__link">
    4 使用create创建关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-merge" class="md-nav__link">
    5 使用merge创建关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-where" class="md-nav__link">
    6 where命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-delete" class="md-nav__link">
    7 delete命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-sort" class="md-nav__link">
    8 sort命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    9 字符串函数：
  </a>
  
    <nav class="md-nav" aria-label="9 字符串函数：">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-toupper" class="md-nav__link">
    1 toUpper()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-tolower" class="md-nav__link">
    2 toLower()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-substring" class="md-nav__link">
    3 substring()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-replace" class="md-nav__link">
    4 replace()函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    10 聚合函数
  </a>
  
    <nav class="md-nav" aria-label="10 聚合函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-count" class="md-nav__link">
    1 count()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-max" class="md-nav__link">
    2 max()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-min" class="md-nav__link">
    3 min()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-sum" class="md-nav__link">
    4 sum()函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-avg" class="md-nav__link">
    5 avg()函数
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-index" class="md-nav__link">
    11 索引index
  </a>
  
    <nav class="md-nav" aria-label="11 索引index">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1 创建索引
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 删除索引
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    12 小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#34-pythonneo4j" class="md-nav__link">
    3.4 在Python中使用neo4j
  </a>
  
    <nav class="md-nav" aria-label="3.4 在Python中使用neo4j">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-neo4j-driver" class="md-nav__link">
    1 neo4j-driver简介：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    2 事务的概念
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    3 小节总结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>第三章:neo4j图数据库</h1>

<h2 id="31-neo4j">3.1 neo4j介绍<a class="headerlink" href="#31-neo4j" title="Permanent link">&para;</a></h2>
<p>学习目标</p>
<ul>
<li>了解neo4j图数据库的简介，版本说明。</li>
<li>了解节点，关系，属性，标签的有关概念。</li>
</ul>
<p><img alt="avatar" src="img/neo4j.png" /></p>
<h3 id="1-neo4j">1 neo4j简介<a class="headerlink" href="#1-neo4j" title="Permanent link">&para;</a></h3>
<ul>
<li>neo4j是由Java实现的开源NoSQL图数据库。自从2003年开始研发，到2007年发布第一版。neo4j现如今已经被各行各业的数十万家公司和组织采用。</li>
<li>
<p>neo4j实现了专业数据库级别的图数据模型的存储。与普通的图处理或内存级数据库不同，neo4j提供了完整的数据库特性，包括ACID事物的支持，集群支持，备份与故障转移等。这使其适合于企业级生产环境下的各种应用。</p>
</li>
<li>
<p>neo4j的版本说明：</p>
<ul>
<li>企业版：需要高额的付费获得授权，提供高可用，热备份等性能。</li>
<li>社区开源版：免费使用，但只能单点运行。</li>
</ul>
</li>
</ul>
<h3 id="2-neo4j">2 neo4j图数据库概念<a class="headerlink" href="#2-neo4j" title="Permanent link">&para;</a></h3>
<p><img alt="avatar" src="img/%E6%A0%87%E8%AE%B0%E5%B1%9E%E6%80%A7%E5%9B%BE%E6%A8%A1%E5%9E%8B.png" /></p>
<ul>
<li>
<p>节点</p>
<ul>
<li>节点是主要的数据元素，节点通过关系连接到其他节点，节点可以具有一个或多个属性
(即存储为键/值对的属性), 节点有一个或多个标签，用于描述其在图表中的作用。示例：Person&gt;节点。</li>
<li>可以将节点类比为关系型数据库中的表，对应的标签可以类比为不同的表名，属性就是表中的列。</li>
</ul>
</li>
<li>
<p>关系</p>
<ul>
<li>关系连接两个节点，关系是方向性的，关系可以有一个或多个属性(即存储为键/值对的
属性).</li>
</ul>
</li>
<li>
<p>属性</p>
<ul>
<li>属性是命名值，其中名称(或键)是字符串，属性可以被索引和约束，可以从多个属性创
建复合索引。</li>
</ul>
</li>
<li>
<p>标签</p>
<ul>
<li>标签用于组节点到集，节点可以具有多个标签，对标签进行索引以加速在图中查找节点。</li>
</ul>
</li>
</ul>
<h2 id="32-neo4j">3.2 neo4j图数据库的安装<a class="headerlink" href="#32-neo4j" title="Permanent link">&para;</a></h2>
<p>学习目标
* 掌握neo4j图数据库的安装流程及其可视化后台的登陆</p>
<h3 id="1-neo4j_1">1 neo4j图数据库的安装流程<a class="headerlink" href="#1-neo4j_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>第一步：将neo4j安装信息载入到yum检索列表。</p>
</li>
<li>
<p>第二步：使用yum install命令安装。</p>
</li>
<li>
<p>第三步：修改配置文件内容 /etc/neo4j/neo4j.conf.</p>
</li>
<li>
<p>第四步：启动neo4j数据库。</p>
</li>
</ul>
<p>第一步：将neo4j安装信息载入到yum检索列表</p>
<div class="highlight"><pre><span></span><code>rpm --import http://debian.neo4j.org/neotechnology.gpg.key

vim  /etc/yum.repos.d/neo4j.repo
<span class="c1"># 写入下面内容</span>
<span class="o">[</span>neo4j<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>Neo4j RPM Repository
<span class="nv">baseurl</span><span class="o">=</span>http://yum.neo4j.org/stable
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</code></pre></div>
<p>第二步：使用yum install命令安装</p>
<div class="highlight"><pre><span></span><code>yum install neo4j
</code></pre></div>
<p>第三步：修改配置文件默认在/etc/neo4j/neo4j.conf, 为了方便显示下面把一些修改显示在这里</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 数据库的存储库存储位置、日志位置等</span>
dbms.directories.data<span class="o">=</span>/var/lib/neo4j/data
dbms.directories.plugins<span class="o">=</span>/var/lib/neo4j/plugins
dbms.directories.certificates<span class="o">=</span>/var/lib/neo4j/certificates
dbms.directories.logs<span class="o">=</span>/var/log/neo4j
dbms.directories.lib<span class="o">=</span>/usr/share/neo4j/lib
dbms.directories.run<span class="o">=</span>/var/run/neo4j

<span class="c1"># 导入的位置</span>
dbms.directories.import<span class="o">=</span>/var/lib/neo4j/import

<span class="c1"># 初始化内存大小</span>
dbms.memory.heap.initial_size<span class="o">=</span>512m <span class="c1"># 将这一行注释去掉</span>

<span class="c1"># web页面地址</span>
dbms.connectors.default_listen_address<span class="o">=</span><span class="m">0</span>.0.0.0

<span class="c1"># HTTP Connector. There can be zero or one HTTP connectors.</span>
dbms.connector.http.enabled<span class="o">=</span><span class="nb">true</span>
dbms.connector.http.listen_address<span class="o">=</span>:7474 <span class="c1"># 将这一行注释去掉</span>

<span class="c1"># HTTPS Connector. There can be zero or one HTTPS connectors.</span>
dbms.connector.https.enabled<span class="o">=</span><span class="nb">true</span>
dbms.connector.https.listen_address<span class="o">=</span>:7473 <span class="c1"># 将这一行注释去掉</span>


<span class="c1"># Bolt 连接地址</span>
dbms.connector.bolt.enabled<span class="o">=</span><span class="nb">true</span>
<span class="c1"># dbms.connector.bolt.tls_level=OPTIONAL</span>
dbms.connector.bolt.listen_address<span class="o">=</span>:7687 <span class="c1"># 将这一行注释去掉</span>
</code></pre></div>
<p>第四步：启动neo4j数据库</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 启动命令</span>
neo4j start

<span class="c1"># 终端显示如下，代表启动成功</span>
Active database: graph.db
Directories <span class="k">in</span> use:
  home:         /var/lib/neo4j
  config:       /etc/neo4j
  logs:         /var/log/neo4j
  plugins:      /var/lib/neo4j/plugins
  import:       /var/lib/neo4j/import
  data:         /var/lib/neo4j/data
  certificates: /var/lib/neo4j/certificates
  run:          /var/run/neo4j
Starting Neo4j.
WARNING: Max <span class="m">1024</span> open files allowed, minimum of <span class="m">40000</span> recommended. See the Neo4j manual.
Started neo4j <span class="o">(</span>pid <span class="m">2463</span><span class="o">)</span>. It is available at http://localhost:7474/
There may be a short delay <span class="k">until</span> the server is ready.
See /var/log/neo4j/neo4j.log <span class="k">for</span> current status.
</code></pre></div>
<h3 id="2-neo4j_1">2 neo4j的可视化管理后台登陆<a class="headerlink" href="#2-neo4j_1" title="Permanent link">&para;</a></h3>
<ul>
<li>访问地址：<a href="http://192.168.88.161:7474">http://192.168.88.161:7474</a></li>
<li>ConnectURL: bolt://192.168.88.161:7687</li>
<li>Username: neo4j</li>
<li>Password: neo4j (第一次登录)，虚拟机中已改成123456</li>
</ul>
<p><img alt="image-20220602174022900" src="img/image-20220602174022900.png" /></p>
<h3 id="3">3 小节总结<a class="headerlink" href="#3" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>学习了neo4j图数据库的安装流程：</p>
<ul>
<li>第一步：将neo4j安装信息载入到yum检索列表。</li>
<li>第二步：使用yum install命令安装。</li>
<li>第三步：修改配置文件内容 /etc/neo4j/neo4j.conf.</li>
<li>第四步：启动neo4j数据库。</li>
</ul>
</li>
<li>
<p>学习了neo4j的可视化管理后台登陆：</p>
<ul>
<li>访问地址：<a href="http://192.168.88.161:7474">http://192.168.88.161:7474</a>.</li>
<li>ConnectURL: bolt://192.168.88.161:7687</li>
<li>Username: neo4j</li>
<li>Password: neo4j (默认)</li>
</ul>
</li>
</ul>
<h2 id="33-cypher">3.3 Cypher介绍与使用<a class="headerlink" href="#33-cypher" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>学习目标</p>
<ul>
<li>了解Cypher的基本概念。</li>
<li>掌握Cypher的基本命令和语法。</li>
</ul>
</li>
<li>
<p>Cypher的基本概念：</p>
<ul>
<li>Cypher是neo4j图数据的查询语言，类似于mysql数据库的sql语句，但是它允许对图形进行富有表现力和有效的查询和更新。</li>
</ul>
</li>
<li>
<p>Cypher的基本命令和语法：</p>
<ul>
<li>create命令</li>
<li>match命令</li>
<li>merge命令</li>
<li>relationship关系命令</li>
<li>where命令</li>
<li>delete命令</li>
<li>sort命令</li>
<li>字符串函数</li>
<li>聚合函数</li>
<li>index索引命令</li>
</ul>
</li>
</ul>
<h3 id="1-create">1 create命令<a class="headerlink" href="#1-create" title="Permanent link">&para;</a></h3>
<p>创建图数据中的节点</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">创建命令格式：</span><span class="w"></span>
<span class="o">#</span><span class="w"> </span><span class="err">此处</span><span class="n">create是关键字</span><span class="err">，创建节点名称</span><span class="n">node_name</span><span class="p">,</span><span class="w"> </span><span class="err">节点标签</span><span class="n">Node_Label</span><span class="p">,</span><span class="w"> </span><span class="err">放在小括号里面</span><span class="p">()</span><span class="w"></span>
<span class="o">#</span><span class="w"> </span><span class="err">后面把所有属于节点标签的属性放在大括号</span><span class="s1">&#39;{}&#39;</span><span class="err">里面，依次写出属性名称：属性值，不同属性用逗号</span><span class="s1">&#39;,&#39;</span><span class="err">分隔</span><span class="w"></span>
<span class="o">#</span><span class="w"> </span><span class="err">例如下面命令创建一个节点</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="err">节点标签是</span><span class="n">Employee</span><span class="p">,</span><span class="w"> </span><span class="err">拥有</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">deptnp四个属性</span><span class="err">：</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="err">{</span><span class="n">id</span><span class="p">:</span><span class="mi">222</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">:</span><span class="mi">6000</span><span class="p">,</span><span class="w"> </span><span class="n">deptnp</span><span class="p">:</span><span class="mi">12</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果</li>
</ul>
<p><img alt="avatar" src="img/1.jpeg" /></p>
<h3 id="2-match">2 match命令<a class="headerlink" href="#2-match" title="Permanent link">&para;</a></h3>
<p>匹配(查询)已有数据</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="n">match命令专门用来匹配查询</span><span class="err">，节点名称：节点标签，依然放在小括号内，然后使用</span><span class="n">return语句返回查询结果</span><span class="err">，和</span><span class="n">SQL很相似</span><span class="err">。</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"></span>

<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">#</span><span class="w"> </span><span class="err">查询所有结点</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/2.jpeg" /></p>
<h3 id="3-merge">3 merge命令<a class="headerlink" href="#3-merge" title="Permanent link">&para;</a></h3>
<p>若节点存在，则等效与match命令; 节点不存在，则等效于create命令。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">MERGE</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="w"> </span><span class="err">{</span><span class="n">id</span><span class="p">:</span><span class="mi">146</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;Lucer&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">salary</span><span class="p">:</span><span class="mi">3500</span><span class="p">,</span><span class="w"> </span><span class="n">deptno</span><span class="p">:</span><span class="mi">16</span><span class="err">}</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/3.jpeg" /></p>
<ul>
<li>
<p>然后再次用merge查询，发现数据库中的数据并没有增加，因为已经存在相同的数据了，merge匹配成功。</p>
</li>
<li>
<p>演示：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>MERGE (e:Employee {id:146, name:&#39;Lucer&#39;, salary:3500, deptno:16})
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/4.jpeg" /></p>
<h3 id="4-create">4 使用create创建关系<a class="headerlink" href="#4-create" title="Permanent link">&para;</a></h3>
<p>必须创建有方向性的关系，否则报错。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">创建一个节点</span><span class="n">p1到p2的有方向关系</span><span class="err">，这个关系</span><span class="n">r的标签为Buy</span><span class="p">,</span><span class="w"> </span><span class="err">代表</span><span class="n">p1购买了p2</span><span class="p">,</span><span class="w"> </span><span class="err">方向为</span><span class="n">p1指向p2</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="n">Profile1</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">Buy</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">(</span><span class="n">p2</span><span class="p">:</span><span class="n">Profile2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/5.jpeg" /></p>
<h3 id="5-merge">5 使用merge创建关系<a class="headerlink" href="#5-merge" title="Permanent link">&para;</a></h3>
<p>可以创建有/无方向性的关系。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">创建一个节点</span><span class="n">p1到p2的无方向关系</span><span class="err">，这个关系</span><span class="n">r的标签为miss</span><span class="p">,</span><span class="w"> </span><span class="err">代表</span><span class="n">p1</span><span class="o">-</span><span class="n">miss</span><span class="o">-</span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="err">方向为相互的</span><span class="w"></span>
<span class="n">MERGE</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="n">Profile1</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">:</span><span class="n">miss</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">p2</span><span class="p">:</span><span class="n">Profile2</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/6.jpeg" /></p>
<h3 id="6-where">6 where命令<a class="headerlink" href="#6-where" title="Permanent link">&para;</a></h3>
<p>类似于SQL中的添加查询条件。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">查询节点</span><span class="n">Employee中</span><span class="err">，</span><span class="n">id值等于123的那个节点</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">123</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/7.jpeg" /></p>
<h3 id="7-delete">7 delete命令<a class="headerlink" href="#7-delete" title="Permanent link">&para;</a></h3>
<p>删除节点/关系及其关联的属性。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">注意：删除节点的同时，也要删除关联的关系边</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="p">:</span><span class="n">Profile1</span><span class="p">)</span><span class="o">-</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">p2</span><span class="p">:</span><span class="n">Profile2</span><span class="p">)</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="image-20220602161351010" src="img/10.png" /></p>
<h3 id="8-sort">8 sort命令<a class="headerlink" href="#8-sort" title="Permanent link">&para;</a></h3>
<p>Cypher命令中的排序使用的是order by.</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">匹配查询标签</span><span class="n">Employee</span><span class="p">,</span><span class="w"> </span><span class="err">将所有匹配结果按照</span><span class="n">id值升序排列后返回结果</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="w"></span>

<span class="o">#</span><span class="w"> </span><span class="err">如果要按照降序排序，只需要将</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary改写为ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="k">DESC</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="w"> </span><span class="k">DESC</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/11.jpeg" /></p>
<h3 id="9">9 字符串函数：<a class="headerlink" href="#9" title="Permanent link">&para;</a></h3>
<ul>
<li>toUpper()函数</li>
<li>toLower()函数</li>
<li>substring()函数</li>
<li>replace()函数</li>
</ul>
<h4 id="1-toupper">1 toUpper()函数<a class="headerlink" href="#1-toupper" title="Permanent link">&para;</a></h4>
<p>将一个输入字符串转换为大写字母。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">toUpper</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/12.jpeg" /></p>
<h4 id="2-tolower">2 toLower()函数<a class="headerlink" href="#2-tolower" title="Permanent link">&para;</a></h4>
<p>将一个输入字符串转换为小写字母。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">toLower</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/13.jpeg" /></p>
<h4 id="3-substring">3 substring()函数<a class="headerlink" href="#3-substring" title="Permanent link">&para;</a></h4>
<p>返回一个子字符串。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">输入字符串为</span><span class="n">input_str</span><span class="p">,</span><span class="w"> </span><span class="err">返回从索引</span><span class="n">start_index开始</span><span class="err">，到</span><span class="n">end_index</span><span class="o">-</span><span class="mi">1</span><span class="err">结束的子字符串</span><span class="w"></span>
<span class="k">substring</span><span class="p">(</span><span class="n">input_str</span><span class="p">,</span><span class="w"> </span><span class="n">start_index</span><span class="p">,</span><span class="w"> </span><span class="n">end_index</span><span class="p">)</span><span class="w"></span>

<span class="o">#</span><span class="w"> </span><span class="err">示例代码，返回员工名字的前两个字母</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">substring</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/14.jpeg" /></p>
<h4 id="4-replace">4 replace()函数<a class="headerlink" href="#4-replace" title="Permanent link">&para;</a></h4>
<p>替换掉子字符串。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">输入字符串为</span><span class="n">input_str</span><span class="p">,</span><span class="w"> </span><span class="err">将输入字符串中符合</span><span class="n">origin_str的部分</span><span class="err">，替换成</span><span class="n">new_str</span><span class="w"></span>
<span class="k">replace</span><span class="p">(</span><span class="n">input_str</span><span class="p">,</span><span class="w"> </span><span class="n">origin_str</span><span class="p">,</span><span class="w"> </span><span class="n">new_str</span><span class="p">)</span><span class="w"></span>

<span class="o">#</span><span class="w"> </span><span class="err">示例代码，将员工名字替换为添加后缀</span><span class="n">_HelloWorld</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">replace</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="ss">&quot;_HelloWorld&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"></span>
<span class="o">#</span><span class="w"> </span><span class="err">还原</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="k">replace</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;_HelloWorld&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">deptno</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/15.jpeg" /></p>
<h3 id="10">10 聚合函数<a class="headerlink" href="#10" title="Permanent link">&para;</a></h3>
<ul>
<li>count()函数</li>
<li>max()函数</li>
<li>min()函数</li>
<li>sum()函数</li>
<li>avg()函数</li>
</ul>
<h4 id="1-count">1 count()函数<a class="headerlink" href="#1-count" title="Permanent link">&para;</a></h4>
<p>返回由match命令匹配成功的条数。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">返回匹配标签</span><span class="n">Employee成功的记录个数</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/16.jpeg" /></p>
<h4 id="2-max">2 max()函数<a class="headerlink" href="#2-max" title="Permanent link">&para;</a></h4>
<p>返回由match命令匹配成功的记录中的最大值。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">返回匹配标签</span><span class="n">Employee成功的记录中</span><span class="err">，最高的工资数字</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/17.jpeg" /></p>
<h4 id="3-min">3 min()函数<a class="headerlink" href="#3-min" title="Permanent link">&para;</a></h4>
<p>返回由match命令匹配成功的记录中的最小值。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">返回匹配标签</span><span class="n">Employee成功的记录中</span><span class="err">，最低的工资数字</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="k">min</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/18.jpeg" /></p>
<h4 id="4-sum">4 sum()函数<a class="headerlink" href="#4-sum" title="Permanent link">&para;</a></h4>
<p>返回由match命令匹配成功的记录中某字段的全部加和值。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">返回匹配标签</span><span class="n">Employee成功的记录中</span><span class="err">，所有员工工资的和</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/19.jpeg" /></p>
<h4 id="5-avg">5 avg()函数<a class="headerlink" href="#5-avg" title="Permanent link">&para;</a></h4>
<p>返回由match命令匹配成功的记录中某字段的平均值。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">返回匹配标签</span><span class="n">Employee成功的记录中</span><span class="err">，所有员工工资的平均值</span><span class="w"></span>
<span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">:</span><span class="n">Employee</span><span class="p">)</span><span class="w"> </span><span class="k">RETURN</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/20.jpeg" /></p>
<h3 id="11-index">11 索引index<a class="headerlink" href="#11-index" title="Permanent link">&para;</a></h3>
<ul>
<li>Neo4j支持在节点或关系属性上的索引，以提高查询的性能。</li>
<li>可以为具有相同标签名称的所有节点的属性创建索引。</li>
</ul>
<h4 id="1">1 创建索引<a class="headerlink" href="#1" title="Permanent link">&para;</a></h4>
<p>使用create index on来创建索引。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">创建节点</span><span class="n">Employee上面属性id的索引</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">ON</span><span class="p">:</span><span class="n">Employee</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/21.jpeg" /></p>
<h4 id="2">2 删除索引<a class="headerlink" href="#2" title="Permanent link">&para;</a></h4>
<p>使用drop index on来删除索引。</p>
<ul>
<li>演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span><span class="w"> </span><span class="err">删除节点</span><span class="n">Employee上面属性id的索引</span><span class="w"></span>
<span class="k">DROP</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="k">ON</span><span class="p">:</span><span class="n">Employee</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ul>
<li>效果：</li>
</ul>
<p><img alt="avatar" src="img/22.jpeg" /></p>
<h3 id="12">12 小节总结<a class="headerlink" href="#12" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>学习了Cypher的基本概念：</p>
<ul>
<li>Cypher是neo4j图数据的查询语言，类似于mysql数据库的sql语句，但是它允许对图形进行富有表现力和有效的查询和更新。</li>
</ul>
</li>
<li>
<p>Cypher的基本命令和语法：</p>
<ul>
<li>
<p>create命令：创建图数据中的节点。</p>
<ul>
<li>CREATE (e:Employee{id:222, name:'Bob', salary:6000, deptnp:12})</li>
</ul>
</li>
<li>
<p>match命令：匹配(查询)已有数据。</p>
<ul>
<li>MATCH (e:Employee) RETURN e.id, e.name, e.salary, e.deptno</li>
</ul>
</li>
<li>
<p>merge命令：若节点存在，则等效与match命令; 节点不存在，则等效于create命令。</p>
<ul>
<li>MERGE (e:Employee {id:145, name:'Lucy', salary:7500, deptno:12})</li>
</ul>
</li>
<li>
<p>使用create创建关系：必须创建有方向性的关系，否则报错。</p>
<ul>
<li>CREATE (p1:Profile1)-[r:Buy]-&gt;(p2:Profile2)</li>
</ul>
</li>
<li>
<p>使用merge创建关系：可以创建有/无方向性的关系。</p>
<ul>
<li>MERGE (p1:Profile1)-[r:miss]-(p2:Profile2)</li>
</ul>
</li>
<li>
<p>where命令：类似于SQL中的添加查询条件。</p>
<ul>
<li>MATCH (e:Employee) WHERE e.id=123 RETURN e</li>
</ul>
</li>
<li>
<p>delete命令：删除节点/关系及其关联的属性。</p>
<ul>
<li>MATCH (c1:CreditCard)-[r]-(c2:Customer) DELETE c1, r, c2</li>
</ul>
</li>
<li>
<p>sort命令：Cypher命令中的排序使用的是order by.</p>
<ul>
<li>MATCH (e:Employee) RETURN e.id, e.name, e.salary, e.deptno ORDER BY e.id</li>
</ul>
</li>
<li>
<p>toUpper()函数：将一个输入字符串转换为大写字母。</p>
<ul>
<li>MATCH (e:Employee) RETURN e.id, toUpper(e.name), e.salary, e.deptno</li>
</ul>
</li>
<li>
<p>toLower()函数：讲一个输入字符串转换为小写字母。</p>
<ul>
<li>MATCH (e:Employee) RETURN e.id, toLower(e.name), e.salary, e.deptno</li>
</ul>
</li>
<li>
<p>substring()函数：返回一个子字符串。</p>
<ul>
<li>MATCH (e:Employee) RETURN e.id, substring(e.name,0,2), e.salary, e.deptno</li>
</ul>
</li>
<li>
<p>replace()函数：替换掉子字符串。</p>
<ul>
<li>MATCH (e:Employee) RETURN e.id, replace(e.name,e.name,e.name + "_HelloWorld"), e.salary, e.deptno</li>
</ul>
</li>
<li>
<p>count()函数：返回由match命令匹配成功的条数。</p>
<ul>
<li>MATCH (e:Employee) RETURN count( * )</li>
</ul>
</li>
<li>
<p>max()函数：返回由match命令匹配成功的记录中的最大值。</p>
<ul>
<li>MATCH (e:Employee) RETURN max(e.salary)</li>
</ul>
</li>
<li>
<p>min()函数：返回由match命令匹配成功的记录中的最小值。</p>
<ul>
<li>MATCH (e:Employee) RETURN min(e.salary)</li>
</ul>
</li>
<li>
<p>sum()函数：返回由match命令匹配成功的记录中某字段的全部加和值。</p>
<ul>
<li>MATCH (e:Employee) RETURN sum(e.salary)</li>
</ul>
</li>
<li>
<p>avg()函数：返回由match命令匹配成功的记录中某字段的平均值。</p>
<ul>
<li>MATCH (e:Employee) RETURN avg(e.salary)</li>
</ul>
</li>
<li>
<p>索引index</p>
<ul>
<li>Neo4j支持在节点或关系属性上的索引，以提高查询的性能。</li>
<li>可以为具有相同标签名称的所有节点的属性创建索引。</li>
</ul>
</li>
<li>
<p>创建索引：使用create index on来创建索引。</p>
<ul>
<li>CREATE INDEX ON:Employee(id)</li>
</ul>
</li>
<li>
<p>删除索引：使用drop index on来删除索引。</p>
<ul>
<li>DROP INDEX ON:Employee(id)    </li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="34-pythonneo4j">3.4 在Python中使用neo4j<a class="headerlink" href="#34-pythonneo4j" title="Permanent link">&para;</a></h2>
<ul>
<li>学习目标<ul>
<li>了解python中neo4j-driver的相关知识。</li>
<li>掌握neo4j中事务概念和操作方法。</li>
</ul>
</li>
</ul>
<h3 id="1-neo4j-driver">1 neo4j-driver简介：<a class="headerlink" href="#1-neo4j-driver" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>neo4j-driver是一个python中的package, 作为python中neo4j的驱动，帮助我们在python程序中更好的使用图数据库。</p>
</li>
<li>
<p>neo4j-driver的安装：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>pip install neo4j-driver
</code></pre></div>
<ul>
<li>neo4j-driver使用演示：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">neo4j</span> <span class="kn">import</span> <span class="n">GraphDatabase</span>

<span class="c1"># uri = &quot;neo4j://192.168.88.161:7687&quot; # 4.x版本用这个</span>
<span class="n">uri</span> <span class="o">=</span> <span class="s2">&quot;bolt://192.168.88.161:7687&quot;</span> <span class="c1"># 3.x版本用这个</span>
<span class="n">driver</span> <span class="o">=</span> <span class="n">GraphDatabase</span><span class="o">.</span><span class="n">driver</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;neo4j&quot;</span><span class="p">,</span> <span class="s2">&quot;123456&quot;</span><span class="p">),</span> <span class="n">max_connection_lifetime</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># 直接用python代码形式访问节点Company, 并返回所有节点信息</span>
<span class="k">with</span> <span class="n">driver</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&quot;CREATE(c:Company) SET c.name=&#39;黑马程序员&#39; RETURN c.name&quot;</span>
    <span class="n">record</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">record</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;result:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>输出效果：</li>
</ul>
<div class="highlight"><pre><span></span><code>result: 黑马程序员
</code></pre></div>
<h3 id="2_1">2 事务的概念<a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>如果一组数据库操作要么全部发生要么一步也不执行，我们称该组处理步骤为一个事务，它是数据库一致性的保证。</p>
</li>
<li>
<p>使用事务的演示：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 下面可以正常执行</span>
<span class="k">def</span> <span class="nf">_some_operations</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">,</span> <span class="n">mouse_name</span><span class="p">):</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;MERGE (a:Cat{name: $cat_name})&quot;</span>
           <span class="s2">&quot;MERGE (b:Mouse{name: $mouse_name})&quot;</span>
           <span class="s2">&quot;MERGE (a)-[r:And]-(b)&quot;</span><span class="p">,</span>
           <span class="n">cat_name</span><span class="o">=</span><span class="n">cat_name</span><span class="p">,</span> <span class="n">mouse_name</span><span class="o">=</span><span class="n">mouse_name</span><span class="p">)</span>


<span class="k">with</span> <span class="n">driver</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">write_transaction</span><span class="p">(</span><span class="n">_some_operations</span><span class="p">,</span> <span class="s2">&quot;Tom&quot;</span><span class="p">,</span> <span class="s2">&quot;Jerry&quot;</span><span class="p">)</span>

<span class="c1"># 下面执行时报错 </span>
<span class="k">def</span> <span class="nf">_some_operations</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">cat_name</span><span class="p">,</span> <span class="n">mouse_name</span><span class="p">):</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&quot;MERGE (a:Cat{name: $cat_name})&quot;</span>
           <span class="s2">&quot;MERGE (b:Mouse{name: $mouse_name})&quot;</span>
           <span class="s2">&quot;CREATE (a)-[r:And]-(b)&quot;</span><span class="p">,</span>
           <span class="n">cat_name</span><span class="o">=</span><span class="n">cat_name</span><span class="p">,</span> <span class="n">mouse_name</span><span class="o">=</span><span class="n">mouse_name</span><span class="p">)</span>

<span class="k">with</span> <span class="n">driver</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">write_transaction</span><span class="p">(</span><span class="n">_some_operations</span><span class="p">,</span> <span class="s2">&quot;Tom1&quot;</span><span class="p">,</span> <span class="s2">&quot;Jerry1&quot;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>输出效果：</li>
</ul>
<p><img alt="avatar" src="img/cat.jpeg" /></p>
<h3 id="3_1">3 小节总结<a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>学习了neo4j-driver简介：</p>
<ul>
<li>neo4j-driver是一个python中的package, 作为python中neo4j的驱动，帮助我们在python程序中更好的使用图数据库。</li>
</ul>
</li>
<li>
<p>学习了neo4j-driver的安装和使用方法。</p>
</li>
<li>
<p>学习了事务的概念：</p>
<ul>
<li>如果一组数据库操作要么全部发生要么一步也不执行，我们称该组处理步骤为一个事务，它是数据库一致性的保证。</li>
</ul>
</li>
<li>
<p>学习了如何使用事务来向图数据库中写入数据。</p>
</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="2.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 第二章:项目工具介绍" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              第二章:项目工具介绍
            </div>
          </div>
        </a>
      
      
        
        <a href="4.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 第四章:离线部分" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              第四章:离线部分
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.1514a9a0.min.js"></script>
      
        <script src="js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>