
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="img/logo.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.6">
    
    
      
        <title>第二章:项目工具介绍 - AI医生 V3.0</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="." title="AI医生 V3.0" class="md-header__button md-logo" aria-label="AI医生 V3.0" data-md-component="logo">
      
  <img src="img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AI医生 V3.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第二章:项目工具介绍
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    <img src="assets/images/logo.svg" height="45px" alt="logo">

  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="AI医生 V3.0" class="md-nav__button md-logo" aria-label="AI医生 V3.0" data-md-component="logo">
      
  <img src="img/logo.png" alt="logo">

    </a>
    AI医生 V3.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="1.html" class="md-nav__link">
        第一章:背景介绍及AI医生架构
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          第二章:项目工具介绍
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="2.html" class="md-nav__link md-nav__link--active">
        第二章:项目工具介绍
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 总体架构中的工具介绍
  </a>
  
    <nav class="md-nav" aria-label="2 总体架构中的工具介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unitapi" class="md-nav__link">
    1 Unit对话API使用
  </a>
  
    <nav class="md-nav" aria-label="1 Unit对话API使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unit" class="md-nav__link">
    1 Unit平台的相关知识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-unitapi" class="md-nav__link">
    2 Unit闲聊API演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-unit-api" class="md-nav__link">
    3 调用Unit API的实现过程
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-flask-web" class="md-nav__link">
    2 Flask web服务框架
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-gunicorn" class="md-nav__link">
    3 Gunicorn服务组件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-redis" class="md-nav__link">
    4 Redis数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-supervisor" class="md-nav__link">
    5 Supervisor服务监控
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-neo4j" class="md-nav__link">
    6 Neo4j图数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="3.html" class="md-nav__link">
        第三章:neo4j图数据库
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="4.html" class="md-nav__link">
        第四章:离线部分
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="5.html" class="md-nav__link">
        第五章:命名实体审核任务
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="6.html" class="md-nav__link">
        第六章:命名实体识别任务
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="7.html" class="md-nav__link">
        第七章:在线部分
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="8.html" class="md-nav__link">
        第八章:句子主题相关任务
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="9.html" class="md-nav__link">
        第九章:系统联调与测试
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10.html" class="md-nav__link">
        附录:环境安装部署手册
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2 总体架构中的工具介绍
  </a>
  
    <nav class="md-nav" aria-label="2 总体架构中的工具介绍">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unitapi" class="md-nav__link">
    1 Unit对话API使用
  </a>
  
    <nav class="md-nav" aria-label="1 Unit对话API使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unit" class="md-nav__link">
    1 Unit平台的相关知识
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-unitapi" class="md-nav__link">
    2 Unit闲聊API演示
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-unit-api" class="md-nav__link">
    3 调用Unit API的实现过程
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-flask-web" class="md-nav__link">
    2 Flask web服务框架
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-gunicorn" class="md-nav__link">
    3 Gunicorn服务组件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-redis" class="md-nav__link">
    4 Redis数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-supervisor" class="md-nav__link">
    5 Supervisor服务监控
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-neo4j" class="md-nav__link">
    6 Neo4j图数据库
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7 小结
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>第二章:项目工具介绍</h1>

<h2 id="2">2 总体架构中的工具介绍<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<ul>
<li>学习目标：<ul>
<li>了解总体架构中使用了哪些工具。</li>
<li>掌握总体架构中各个工具的简介，作用，安装和基本使用方法。</li>
</ul>
</li>
</ul>
<p>总体架构中使用的工具：</p>
<ul>
<li>
<p>Unit对话API使用</p>
</li>
<li>
<p>Flask web服务框架</p>
</li>
<li>Redis数据库</li>
<li>Gunicorn服务组件</li>
<li>Supervisor服务监控器</li>
<li>Neo4j图数据库</li>
</ul>
<h3 id="1-unitapi">1 Unit对话API使用<a class="headerlink" href="#1-unitapi" title="Permanent link">&para;</a></h3>
<p>学习目标：</p>
<ul>
<li>了解Unit平台的相关知识。</li>
<li>掌握调用Unit API的实现过程。</li>
</ul>
<h4 id="1-unit">1 Unit平台的相关知识<a class="headerlink" href="#1-unit" title="Permanent link">&para;</a></h4>
<ul>
<li>Unit平台是百度大脑开放的智能对话定制与服务平台，也是当前最大的中文领域对话开放平台之一。 Unit对注册用户提供免费的对话接口服务，比如中文闲聊API, 百科问答API, 诗句生成API等，通过这些API我们可以感受一下智能对话的魅力，同时它也可以作为任务导向型对话系统无法匹配用户输入时的最终选择。</li>
</ul>
<p><img alt="" src="img/picture1_0512.png" /></p>
<h4 id="2-unitapi">2 Unit闲聊API演示<a class="headerlink" href="#2-unitapi" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>用户输入 &gt;&gt;&gt; &quot;你好&quot;
Unit回复 &gt;&gt;&gt; &quot;你好，想聊什么呢~&quot;
用户输入 &gt;&gt;&gt; &quot;我想有一个女朋友!&quot;
Unit回复 &gt;&gt;&gt; &quot;我也是想要一个女朋友~&quot;
用户输入 &gt;&gt;&gt; &quot;晚吃啥呢想想&quot;
Unit回复 &gt;&gt;&gt; &quot;想吃火锅&quot;
</code></pre></div>
<h4 id="3-unit-api">3 调用Unit API的实现过程<a class="headerlink" href="#3-unit-api" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>第一步：注册登录百度账户，进入Unit控制台创建自己的机器人。</p>
</li>
<li>
<p>第二步：进行相关配置，获得请求API接口需要的API Key与Secret Key。</p>
</li>
<li>
<p>第三步：在服务器上编写API调用脚本并进行测试。</p>
</li>
</ul>
<p>第一步：注册登录百度账户，进入Unit控制台创建自己的机器人，添加闲聊功能</p>
<ul>
<li>创建机器人</li>
</ul>
<p><img alt="" src="img/picture2_0512.png" /></p>
<ul>
<li>添加闲聊功能</li>
</ul>
<p><img alt="image-20220602185800109" src="img/image-20220602185800109.png" /></p>
<p><img alt="image-20220602185952734" src="img/image-20220602185952734.png" /></p>
<p><img alt="image-20220602190049465" src="img/image-20220602190049465.png" /></p>
<p>第二步：进行相关配置，获得请求API接口需要的API Key与Secret Key.</p>
<ul>
<li>
<p>点击获取API Key进入百度云应用管理页面。
  <img alt="" src="img/picture3_0512.png" /></p>
</li>
<li>
<p>点击创建应用，进入应用信息表单填写页面。
  <img alt="" src="img/picture4_0512.png" /></p>
</li>
<li>
<p>填写完毕后，点击立即创建，成功后会提示创建完毕。
  <img alt="" src="img/picture5_0512.png" /></p>
</li>
<li>
<p>点击返回应用列表</p>
</li>
</ul>
<p><img alt="" src="img/picture6_0512.png" /></p>
<ul>
<li>可以看到创建的API Key和Secret Key, 至此创建流程结束。
  <img alt="" src="img/picture7_0512.png" /></li>
</ul>
<p>第三步：在服务器上编写API调用脚本并进行测试</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># client_id 为官网获取的AK， client_secret 为官网获取的SK</span>
<span class="n">client_id</span> <span class="o">=</span> <span class="s2">&quot;74b8zns7KLC9T4Fv9UA0Fwra&quot;</span>
<span class="n">client_secret</span> <span class="o">=</span> <span class="s2">&quot;9kEGPhgTdlliXXEbZYkoDUbDjyBiBMIZ&quot;</span>
<span class="c1"># service_id是机器人id</span>
<span class="n">service_id</span> <span class="o">=</span> <span class="s2">&quot;S70282&quot;</span>

<span class="k">def</span> <span class="nf">unit_chat</span><span class="p">(</span><span class="n">chat_input</span><span class="p">,</span> <span class="n">terminal_id</span><span class="o">=</span><span class="s2">&quot;88888&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    description:调用百度UNIT接口，回复聊天内容</span>
<span class="sd">    Parameters</span>
<span class="sd">      ----------</span>
<span class="sd">      chat_input : str</span>
<span class="sd">          用户发送天内容</span>
<span class="sd">      terminal_id : str</span>
<span class="sd">          发起聊天用户ID，可任意定义</span>
<span class="sd">    Return</span>
<span class="sd">      ----------</span>
<span class="sd">      返回unit回复内容</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 设置默认回复内容， 一旦接口出现异常，回复该内容</span>
    <span class="n">chat_reply</span> <span class="o">=</span> <span class="s2">&quot;不好意思，俺们正在学习中，随后回复你。&quot;</span>
    <span class="c1"># 根据 client_id 与 client_secret 获取access_token</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&amp;client_id=</span><span class="si">%s</span><span class="s2">&amp;client_secret=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="c1"># print(res)</span>
    <span class="n">access_token</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
    <span class="c1"># print(&#39;access_token&#39;, access_token)</span>
    <span class="c1"># 根据 access_token 获取聊天机器人接口数据</span>
    <span class="n">unit_chatbot_url</span> <span class="o">=</span> <span class="s2">&quot;https://aip.baidubce.com/rpc/2.0/unit/service/v3/chat?access_token=&quot;</span> <span class="o">+</span> <span class="n">access_token</span>
    <span class="c1"># 拼装聊天接口对应请求发送数据，主要是填充 query 值</span>
    <span class="n">post_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;log_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()),</span>
                <span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">chat_input</span><span class="p">,</span>
                    <span class="s2">&quot;terminal_id&quot;</span><span class="p">:</span><span class="n">terminal_id</span>
                <span class="p">},</span>
                <span class="s2">&quot;session_id&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;service_id&quot;</span><span class="p">:</span> <span class="n">service_id</span><span class="p">,</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;3.0&quot;</span>
            <span class="p">}</span>
    <span class="c1"># 将封装好的数据作为请求内容，发送给Unit聊天机器人接口，并得到返回结果</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">unit_chatbot_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">post_data</span><span class="p">)</span>

    <span class="c1"># 获取聊天接口返回数据</span>
    <span class="n">unit_chat_obj</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="c1"># 打印返回的结果</span>
    <span class="c1"># print(unit_chat_obj)</span>

    <span class="c1"># 判断聊天接口返回数据是否出错 error_code == 0 则表示请求正确</span>
    <span class="k">if</span> <span class="n">unit_chat_obj</span><span class="p">[</span><span class="s2">&quot;error_code&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">chat_reply</span>

    <span class="c1"># 解析聊天接口返回数据，找到返回文本内容 result -&gt; responses -&gt; schema -&gt; intent_confidence(&gt;0) -&gt; actions -&gt; say</span>
    <span class="n">unit_chat_obj_result</span> <span class="o">=</span> <span class="n">unit_chat_obj</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">]</span>
    <span class="n">unit_chat_response_list</span> <span class="o">=</span> <span class="n">unit_chat_obj_result</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">]</span>

    <span class="c1"># 随机选取一个&quot;意图置信度&quot;[+responses[].schema.intent_confidence]不为0的作为回答</span>
    <span class="n">unit_chat_response_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span>
       <span class="p">[</span><span class="n">unit_chat_response</span> <span class="k">for</span> <span class="n">unit_chat_response</span> <span class="ow">in</span> <span class="n">unit_chat_response_list</span> <span class="k">if</span>
        <span class="n">unit_chat_response</span><span class="p">[</span><span class="s2">&quot;schema&quot;</span><span class="p">][</span><span class="s2">&quot;intents&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;intent_confidence&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">])</span>

    <span class="c1"># 获取所有答复，并随机选择一个</span>
    <span class="n">unit_chat_response_action_list</span> <span class="o">=</span> <span class="n">unit_chat_response_obj</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span>
    <span class="n">unit_chat_response_action_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">unit_chat_response_action_list</span><span class="p">)</span>
    <span class="n">unit_chat_response_say</span> <span class="o">=</span> <span class="n">unit_chat_response_action_obj</span><span class="p">[</span><span class="s2">&quot;say&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">unit_chat_response_say</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">chat_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;请输入：&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chat_input</span> <span class="o">==</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">or</span> <span class="n">chat_input</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span> <span class="ow">or</span> <span class="n">chat_input</span> <span class="o">==</span> <span class="s1">&#39;bye&#39;</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">chat_input</span><span class="p">)</span>
        <span class="n">chat_reply</span> <span class="o">=</span> <span class="n">unit_chat</span><span class="p">(</span><span class="n">chat_input</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;用户输入 &gt;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">chat_input</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unit回复 &gt;&gt;&gt;&quot;</span><span class="p">,</span> <span class="n">chat_reply</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>执行</li>
</ul>
<div class="highlight"><pre><span></span><code>python unit.py
</code></pre></div>
<ul>
<li>输出效果</li>
</ul>
<div class="highlight"><pre><span></span><code>请输入：你好啊
你好啊
用户输入 &gt;&gt;&gt; 你好啊
Unit回复 &gt;&gt;&gt; 你也好啊~
请输入：今天天气棒棒哒
今天天气棒棒哒
用户输入 &gt;&gt;&gt; 今天天气棒棒哒
Unit回复 &gt;&gt;&gt; 必须的
请输入：晚饭吃点什么?
晚饭吃点什么?
用户输入 &gt;&gt;&gt; 晚饭吃点什么?
Unit回复 &gt;&gt;&gt; 晚饭没吃，减肥
请输入：
</code></pre></div>
<h3 id="2-flask-web">2 Flask web服务框架<a class="headerlink" href="#2-flask-web" title="Permanent link">&para;</a></h3>
<p><center><img style="margin: 0px 0px 0px 0px" src="./img/Flask.png" width="400px" height="400px"></center></p>
<ul>
<li>简介：<ul>
<li>Flask框架是当下最受欢迎的python轻量级框架，也是pytorch官网指定的部署框架。 Flask的基本模式为在程序里将一个视图函数分配给一个URL，每当用户访问这个URL时，系统就会执行给该URL分配好的视图函数，获取函数的返回值，其工作过程见图。</li>
<li><img alt="avatar" src="img/Flask_1.png" /></li>
</ul>
</li>
</ul>
<p><center></center></p>
<ul>
<li>
<p>作用：</p>
<ul>
<li>在项目中，Flask框架是主逻辑服务和句子相关模型服务使用的服务框架。</li>
</ul>
</li>
<li>
<p>安装：
<div class="highlight"><pre><span></span><code><span class="c1"># 使用pip安装Flask</span>
pip install flask
</code></pre></div></p>
</li>
<li>
<p>基本使用方法：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 导入Flask类</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="c1"># 创建一个该类的实例app, 参数为__name__, 这个参数是必需的，</span>
<span class="c1"># 这样Flask才能知道在哪里可找到模板和静态文件等东西。</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># 使用route()装饰器来告诉Flask触发函数的URL</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;请求指定的url后，执行的主要逻辑函数&quot;&quot;&quot;</span>
    <span class="c1"># 在用户浏览器中显示信息：&#39;Hello, World!&#39;</span>
    <span class="k">return</span> <span class="s1">&#39;Hello, World!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</code></pre></div>
<p>启动服务：</p>
<div class="highlight"><pre><span></span><code>python flask_test.py
</code></pre></div>
<p>启动效果：</p>
<ul>
<li>通过浏览器打开地址http://0.0.0.0:5000可看见打印了'Hello, World'.</li>
</ul>
<h3 id="3-gunicorn">3 Gunicorn服务组件<a class="headerlink" href="#3-gunicorn" title="Permanent link">&para;</a></h3>
<p><center><img style="margin: 0px 0px 0px 0px" src="./img/gunicorn.png"></center></p>
<ul>
<li>简介：</li>
<li>
<p>Gunicorn是一个被广泛使用的高性能的Python WSGI UNIX HTTP服务组件(WSGI: Web Server Gateway Interface)，移植自Ruby的独角兽（Unicorn ）项目，具有使用非常简单，轻量级的资源消耗，以及高性能等特点。</p>
</li>
<li>
<p>作用：</p>
</li>
<li>
<p>在项目中，Gunicorn和Flask框架一同使用，能够开启服务，处理请求，因其高性能的特点能够有效减少服务丢包率。</p>
</li>
<li>
<p>安装：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 使用pip安装gunicorn</span>
pip install gunicorn
</code></pre></div>
<ul>
<li>基本使用方法：</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 使用其启动Flask服务：</span>
gunicorn -w <span class="m">1</span> -b <span class="m">0</span>.0.0.0:5000 flask_test:app
<span class="c1"># -w 代表开启的进程数，我们只开启一个进程</span>
<span class="c1"># -b 服务的IP地址和端口</span>
<span class="c1"># flask_test:app 是指执行的主要对象位置，在flask_test.py中的app对象</span>
<span class="c1"># 如果使其在后台运行可使用：</span>
<span class="c1"># nohup gunicorn -w 1 -b 0.0.0.0:5000 flask_test:app 2&gt;&amp;1 &amp;</span>
</code></pre></div>
<h3 id="4-redis">4 Redis数据库<a class="headerlink" href="#4-redis" title="Permanent link">&para;</a></h3>
<p><center><img style="margin: 0px 0px 0px 0px" src="./img/redis.png"></center></p>
<ul>
<li>
<p>简介：</p>
<ul>
<li>Redis（全称：Remote Dictionary Server 远程字典服务）是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API.</li>
<li>作用：<ul>
<li>在项目中，Redis用于会话管理数据库，保存用户聊天历史。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>安装：
<div class="highlight"><pre><span></span><code><span class="c1"># 使用yum安装redis</span>
yum install epel-release
yum install redis -y
</code></pre></div></p>
</li>
<li>
<p>基本使用方法：</p>
<ul>
<li>Redis支持四种数据结构的存储：String(字符串), Hash(散列), List(列表), Set(集合), Sorted Set(有序集合).</li>
<li>在这里我们将着重介绍如何在python中使用Hash(散列)进行读写。</li>
</ul>
</li>
<li>
<p>安装python中的redis驱动：
<div class="highlight"><pre><span></span><code><span class="c1"># 使用pip进行安装</span>
pip install redis
</code></pre></div></p>
</li>
</ul>
<blockquote>
<ul>
<li>启动redis服务：</li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># 启动redis-server, 这里使用了默认配置，端口是6379.</span>
redis-server
</code></pre></div>
<blockquote>
<ul>
<li>在python中使用Hash(散列)进行读写：</li>
</ul>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># coding=utf-8</span>
<span class="c1"># redis配置</span>
<span class="n">REDIS_CONFIG</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span>
     <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">6379</span>
<span class="p">}</span>

<span class="c1"># 导入redis驱动</span>
<span class="kn">import</span> <span class="nn">redis</span>

<span class="c1"># 创建一个redis连接池</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="o">**</span><span class="n">REDIS_CONFIG</span><span class="p">)</span>

<span class="c1"># 从连接池中初始化一个活跃的连接对象</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="n">connection_pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>

<span class="c1"># hset表示使用hash数据结构进行数据写入</span>
<span class="c1"># uid代表某个用户的唯一标识</span>
<span class="n">uid</span> <span class="o">=</span> <span class="s2">&quot;8888&quot;</span>

<span class="c1"># key是需要记录的数据描述</span>
<span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;该用户最后一次说的话：&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="c1"># value是需要记录的数据具体内容</span>
<span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;再见，董小姐&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">hset</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="c1"># hget表示使用hash数据结构进行数据读取</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">hget</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<ul>
<li>输出效果：
<div class="highlight"><pre><span></span><code>再见，董小姐
</code></pre></div></li>
</ul>
</blockquote>
<h3 id="5-supervisor">5 Supervisor服务监控<a class="headerlink" href="#5-supervisor" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>简介：</p>
<ul>
<li>Supervisor是用Python开发的一个client/server服务，是Linux/Unix系统下的一个进程管理工具。它可以很方便的监听、启动、停止、重启一个或多个进程，并守护这些进程。</li>
</ul>
</li>
<li>
<p>作用：</p>
<ul>
<li>在项目中，Supervisor用于监控和守护主要逻辑服务和redis数据库服务。</li>
</ul>
</li>
<li>
<p>安装：
<div class="highlight"><pre><span></span><code><span class="c1"># 使用yum安装supervisor</span>
yum install supervisor -y

systemctl <span class="nb">enable</span> supervisord <span class="c1"># 开机启动</span>
systemctl start supervisord <span class="c1"># 启动服务</span>
</code></pre></div></p>
</li>
<li>
<p>基本使用方法：</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># 编辑配置文件，指明监控和守护的进程开启命令，</span>
<span class="c1"># 请查看/etc/supervisord.conf文件</span>

<span class="c1"># 查看监控的进程状态：</span>
supervisorctl status

<span class="c1"># main_server                      RUNNING   pid 31609, uptime 0:32:20</span>
<span class="c1"># redis                            RUNNING   pid 31613, uptime 0:32:18</span>

<span class="c1"># 关闭supervisor</span>
supervisorctl shutdown 
</code></pre></div>
<ul>
<li>还可以通过浏览器查看可视化监控页面：<a href="http://0.0.0.0:9001">http://0.0.0.0:9001</a></li>
</ul>
<p><center><img style="margin: 0px 0px 0px 0px" src="./img/Supervisor.png"></center></p>
<h3 id="6-neo4j">6 Neo4j图数据库<a class="headerlink" href="#6-neo4j" title="Permanent link">&para;</a></h3>
<ul>
<li>因为在项目中，Neo4j图数据库作为核心的存储和查询数据库，因此会在<a href="3.html">第三章：Neo4j图数据库</a>中对其进行详细的介绍。</li>
</ul>
<h3 id="7">7 小结<a class="headerlink" href="#7" title="Permanent link">&para;</a></h3>
<ul>
<li>学习了总体架构中使用的工具：</li>
<li>
<p>Unit对话API使用</p>
<ul>
<li>学习了Unit平台的相关知识，Unit平台是百度大脑开放的智能对话定制与服务平台，也是当前最大的中文领域对话开放平台之一。</li>
<li>学习了调用Unit API的实现过程：</li>
<li>第一步：注册登录百度账户，进入Unit控制台创建自己的机器人。</li>
<li>第二步：进行相关配置，获得请求API接口需要的API Key与Secret Key.</li>
<li>第三步：在服务器上编写API调用脚本并进行测试。</li>
</ul>
</li>
<li>
<p>Flask web服务框架</p>
<ul>
<li>作用：在项目中，Flask框架是主逻辑服务和句子相关模型服务使用的服务框架。</li>
</ul>
</li>
<li>Redis数据库<ul>
<li>作用：在项目中，Redis用于会话管理数据库，保存用户聊天历史。</li>
</ul>
</li>
<li>Gunicorn服务组件<ul>
<li>作用：在项目中，Gunicorn和Flask框架一同使用，能够开启服务，处理请求，因其高性能的特点能够有效减少服务丢包率。</li>
</ul>
</li>
<li>Supervisor服务监控器<ul>
<li>作用：在项目中，Supervisor用于监控和守护主要逻辑服务和redis数据库服务。</li>
</ul>
</li>
<li>Neo4j图数据库</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="1.html" class="md-footer__link md-footer__link--prev" aria-label="上一页: 第一章:背景介绍及AI医生架构" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              第一章:背景介绍及AI医生架构
            </div>
          </div>
        </a>
      
      
        
        <a href="3.html" class="md-footer__link md-footer__link--next" aria-label="下一页: 第三章:neo4j图数据库" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              第三章:neo4j图数据库
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "search": "assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.1514a9a0.min.js"></script>
      
        <script src="js/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>